/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsxs as p,jsx as c,Fragment as b}from"@dropins/tools/preact-jsx-runtime.js";import*as d from"@dropins/tools/preact-compat.js";import{useState as x,useEffect as D}from"@dropins/tools/preact-compat.js";import{VComponent as C,classes as z,Slot as S}from"@dropins/tools/lib.js";import{Button as A,Icon as R,ActionButton as H,PriceRange as N,Divider as U,Checkbox as V,RadioButton as j}from"@dropins/tools/components.js";/* empty css                 */import{useText as $}from"@dropins/tools/i18n.js";/* empty css                   *//* empty css                      *//* empty css                   */import{events as M}from"@dropins/tools/event-bus.js";const P=e=>d.createElement("svg",{id:"Icon_Add_Base","data-name":"Icon \\u2013 Add \\u2013 Base",xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",...e},d.createElement("g",{id:"Large"},d.createElement("rect",{id:"Placement_area","data-name":"Placement area",width:24,height:24,fill:"#fff",opacity:0}),d.createElement("g",{id:"Add_icon","data-name":"Add icon",transform:"translate(9.734 9.737)"},d.createElement("line",{vectorEffect:"non-scaling-stroke",id:"Line_579","data-name":"Line 579",y2:12.7,transform:"translate(2.216 -4.087)",fill:"none",stroke:"currentColor"}),d.createElement("line",{vectorEffect:"non-scaling-stroke",id:"Line_580","data-name":"Line 580",x2:12.7,transform:"translate(-4.079 2.263)",fill:"none",stroke:"currentColor"})))),T=e=>d.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e},d.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M3 12H21",stroke:"currentColor"}),d.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M3 6H21",stroke:"currentColor"}),d.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M3 18H21",stroke:"currentColor"})),W=e=>d.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e},d.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M18.3599 5.64001L5.62988 18.37",stroke:"currentColor"}),d.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M18.3599 18.37L5.62988 5.64001",stroke:"currentColor"})),Y=e=>d.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e},d.createElement("path",{d:"M17.3332 11.75H6.6665",strokeWidth:1.5,strokeLinecap:"square",strokeLinejoin:"round",vectorEffect:"non-scaling-stroke",fill:"none",stroke:"currentColor"})),G=({numberOfOptionsConfig:e=5,header:n,buckets:a})=>{const l=$({showMore:"Search.Facet.showMore",showLess:"Search.Facet.showLess"}),h=e,[g,f]=x(a.length<h),w=g?a.length:h;return p("div",{children:[c(C,{className:"product-discovery-facet__header",node:n}),a.slice(0,w).map((v,F)=>c(C,{className:"product-discovery-facet__bucket",node:v},F)),!g&&a.length>h&&c(A,{variant:"tertiary",icon:c(R,{source:P,size:"24"}),onClick:()=>f(!g),children:l.showMore}),g&&a.length>h&&c(A,{variant:"tertiary",icon:c(R,{source:Y,size:"24"}),onClick:()=>f(!g),children:l.showLess})]})},J=({selectedFacets:e,facets:n})=>{const[a,l]=x(!0),h=()=>{l(!a)};return p("div",{className:"product-discovery-facet-list",children:[c("div",{className:"product-discovery-facet-list__show-filters-button",children:p(H,{onClick:()=>{h()},children:[c(R,{source:T,size:"16"}),c("span",{children:"Filters"})]})}),c(C,{className:"product-discovery-facet-list__selected-filters",node:e}),c(C,{className:z(["product-discovery-facet-list__facet-options",["product-discovery-facet-list__facet-options--hidden",a]]),node:n})]})},K="no",Q="yes",X=e=>{const n=e.buckets.find(a=>a.selected);return n?{attribute:e.attribute,range:{from:n.from,to:n.to}}:null},Z=e=>{const n=e.buckets.reduce((a,l)=>(l.selected&&a.push(l.title),a),[]);return n.length===0?null:{attribute:e.attribute,in:n}},I=e=>{var n;switch((n=e.buckets[0])==null?void 0:n.__typename){case"RangeBucket":return X(e);case"ScalarBucket":case"CategoryView":return Z(e)}},ee=e=>{var a,l,h,g,f,w,v,F,k,_,E;const n=e[0];return(h=(l=(a=n==null?void 0:n.price)==null?void 0:a.regular)==null?void 0:l.amount)!=null&&h.currency?n.price.regular.amount.currency:(v=(w=(f=(g=n==null?void 0:n.priceRange)==null?void 0:g.minimum)==null?void 0:f.regular)==null?void 0:w.amount)!=null&&v.currency?(E=(_=(k=(F=n==null?void 0:n.priceRange)==null?void 0:F.minimum)==null?void 0:k.regular)==null?void 0:_.amount)==null?void 0:E.currency:"USD"},te=(e,n,a)=>(n==null?void 0:n.attribute)==="price"?e.from===0?p("div",{style:"display:flex",children:[c(N,{amount:e.from,currency:a||"USD"}),c("span",{style:"padding: 0 2px",children:"-"}),c(N,{amount:e.to,currency:a||"USD"})]}):c(N,{minimumAmount:e.from,maximumAmount:e.to,currency:a||"USD",display:"dash"}):e.title,ne=(e,n)=>e.title===K?`Not ${n.title}`:e.title===Q?n.title:e.title,O=(e,n,a)=>{switch(e.__typename){case"RangeBucket":return te(e,n,a);case"ScalarBucket":case"CategoryView":return ne(e,n)}},he=({slots:e})=>{const n=$({clearAll:"Search.Facet.clearAll"}),[a,l]=x([]),[h,g]=x(null),f=r=>{if(!r||!r.result.facets&&!r.result.items&&!r.request.filter){l([]);return}const{facets:i,items:m}=r.result;g(ee(m));const t=r.request.filter;if(i){const s=i.map(o=>{const B=o.buckets.map(u=>{u.selected=!1;const L=t==null?void 0:t.find(y=>y.attribute===o.attribute);if(L){const y=L.range;(y&&u.from===y.from&&u.to===y.to||L.in&&L.in.includes(u.title))&&(u.selected=!0)}return u});return o.buckets=B,o});l(s)}},w=r=>{const i=a.map(t=>{const s=r.find(o=>o.attribute===t.attribute);return s||t}),m=i.reduce((t,s)=>{const o=I(s);return o&&t.push(o),t},[]);l(i),M.emit("search/request",{filter:m})},v=(r,i)=>{const m=r.buckets.map(s=>(s.title===i&&(s.selected=!1),s)),t=r;t.buckets=m,w([t])},F=()=>{const r=a.map(i=>{const m=i.buckets.map(t=>(t.selected=!1,t));return i.buckets=m,i});l(r),M.emit("search/request",{filter:[]})},k=(r,i)=>{const m=i.buckets.map(s=>{var o;return((o=i.buckets[0])==null?void 0:o.__typename)==="RangeBucket"&&(s.selected=!1),s.title===r.target.value&&(s.selected=r.target.checked),s}),t=i;t.buckets=m,w([t])},_=r=>{const i=c("span",{children:r.title}),m=r.buckets.map(t=>{var B;const s=O(t,r,h),o=u=>p(S,{name:"FacetBucketLabel",slot:e==null?void 0:e.FacetBucketLabel,context:{data:t},children:[s," ",u?`(${u})`:""]});switch((B=r.buckets[0])==null?void 0:B.__typename){case"RangeBucket":return c(S,{name:"FacetBucket",slot:e==null?void 0:e.FacetBucket,context:{data:t},children:c(j,{"data-testid":`${t.title}-radio`,label:o(),name:r.attribute,value:t.title,checked:t.selected,onChange:u=>{k(u,r)}})});case"ScalarBucket":case"CategoryView":return c(S,{name:"FacetBucket",slot:e==null?void 0:e.FacetBucket,context:{data:t},children:c(V,{"data-testid":`${t.title}-checkbox`,label:o(t.count),name:r.attribute,value:t.title,checked:t.selected,onChange:u=>{k(u,r)}})});default:return null}}).filter(t=>t!==null);return c(G,{header:i,buckets:m})},E=()=>c(S,{name:"Facets",slot:e==null?void 0:e.Facets,context:{data:a},children:a.map(r=>r.buckets.length>0?p(b,{children:[c(S,{name:"Facet",slot:e==null?void 0:e.Facet,context:{data:r},children:_(r)}),c(U,{variant:"secondary"})]}):null)}),q=()=>{const r=a.reduce((t,s)=>(s.buckets.filter(B=>B.selected).length>0&&t.push(s),t),[]),i=r.map(t=>t.buckets.map(s=>{if(s.selected){const o=O(s,t,h);return c(A,{"data-testid":`${s.title}-selected-btn`,"aria-label":`Remove ${t.title} filter: ${s.title}`,variant:"secondary",children:p(b,{children:[c("span",{children:o}),c(R,{source:W,size:"16"})]}),onClick:()=>{v(t,s.title)}})}return null})),m=i.length>0?c(A,{variant:"secondary",onClick:()=>{F()},children:c("span",{children:n.clearAll})}):null;return p(S,{name:"SelectedFacets",slot:e==null?void 0:e.SelectedFacets,context:{data:r},children:[i,m]})};return D(()=>{M.on("search/result",f)},[]),c(J,{selectedFacets:q(),facets:E()})};export{he as Facets,he as default};
//# sourceMappingURL=Facets.js.map
